<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مولد السيرة الذاتية متعدد اللغات ومتوافق مع ATS</title>
    <!-- تحميل Tailwind CSS لأفضل تصميم مستجيب (Responsive) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* تعريف خط Inter كخط أساسي للتطبيق */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9; /* لون خلفية خفيف */
            transition: background-color 0.3s;
        }
        
        /* تنسيقات الطباعة (تُطبق فقط عند الطباعة) */
        @media print {
            body {
                background-color: #fff !important; /* خلفية بيضاء للطباعة */
            }
            /* إخفاء عناصر التحكم (الإدخال والأزرار) عند الطباعة */
            .controls-area, .no-print, #entry-modal {
                display: none !important;
            }
            /* جعل منطقة السيرة الذاتية تأخذ عرض الصفحة بالكامل */
            .cv-container {
                box-shadow: none !important;
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
                max-width: none !important;
                min-height: 100vh;
            }

            /* ضمان تنسيق الخطوط والأحجام لسهولة القراءة في النسخة المطبوعة */
            .cv-container h1, .cv-container h2, .cv-container h3 {
                color: #000 !important;
                font-weight: 700 !important;
            }
            .cv-container p, .cv-container li {
                color: #333 !important;
                font-size: 11pt;
            }

            /* تخصيص طباعة قالب بسيط */
            .simple-template {
                border: none !important;
            }
            /* تخصيص طباعة قالب عصري */
            .modern-template .section-title {
                border-bottom: 2px solid #3b82f6 !important;
            }
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <!-- Modal Structure -->
    <div id="entry-modal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-75 flex justify-center items-center backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 p-6 relative border border-blue-400 transform transition-all duration-300 scale-95 opacity-0" id="modal-content-wrapper">
            <h3 id="modal-title" class="text-2xl font-bold mb-4 border-b pb-2 text-blue-700">إضافة بند جديد</h3>
            
            <div id="modal-content" class="space-y-4">
                <!-- Fields injected here -->
            </div>

            <div class="flex justify-end space-x-4 space-x-reverse mt-6">
                <button id="modal-save-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition duration-300 shadow-lg transform hover:scale-[1.02]">
                    تمت الإضافة
                </button>
                <button onclick="closeModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-6 rounded-lg transition duration-300">
                    إلغاء
                </button>
            </div>
            <button onclick="closeModal()" class="absolute top-3 left-3 text-gray-400 hover:text-gray-600 text-3xl font-light" title="إغلاق">&times;</button>
        </div>
    </div>

    <!-- Header and Controls -->
    <div class="controls-area max-w-7xl mx-auto mb-8">
        <header class="text-center mb-6">
            <h1 class="text-4xl font-extrabold text-blue-700">مولد السيرة الذاتية (ATS Friendly)</h1>
            <p class="text-gray-600 mt-2 text-lg">أدخل بياناتك واختر الشكل واللغة المناسبين لضمان أعلى توافق مع أنظمة الفرز الآلي.</p>
        </header>

        <!-- أدوات التحكم والطباعة واللغة -->
        <div class="bg-white p-5 rounded-xl shadow-2xl flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0 md:space-x-4 md:space-x-reverse mb-8 border border-blue-200">
            <!-- اختيار القالب -->
            <div class="flex items-center space-x-4 space-x-reverse w-full md:w-auto">
                <label for="template-selector" class="text-lg font-bold text-gray-700 whitespace-nowrap">شكل القالب:</label>
                <select id="template-selector" class="block w-full py-2 px-3 border border-gray-300 bg-gray-50 rounded-md shadow-inner focus:ring-blue-500 focus:border-blue-500 transition duration-300">
                    <option value="simple">1. شكل بسيط (الأفضل لـ ATS)</option>
                    <option value="modern">2. شكل عصري</option>
                </select>
            </div>
            
            <!-- اختيار اللغة -->
            <div class="flex items-center space-x-4 space-x-reverse w-full md:w-auto">
                <label for="language-selector" class="text-lg font-bold text-gray-700 whitespace-nowrap">لغة السيرة الذاتية:</label>
                <select id="language-selector" class="block w-full py-2 px-3 border border-gray-300 bg-gray-50 rounded-md shadow-inner focus:ring-blue-500 focus:border-blue-500 transition duration-300">
                    <option value="ar">العربية</option>
                    <option value="en">English</option>
                </select>
            </div>

            <!-- زر الطباعة -->
            <button id="print-button" onclick="printCV()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-[1.02] w-full md:w-auto">
                طباعة السيرة الذاتية <i class="fas fa-print mr-2"></i>
            </button>
        </div>
    </div>

    <div class="max-w-7xl mx-auto flex flex-col lg:flex-row lg:space-x-8 lg:space-x-reverse">
        
        <!-- منطقة إدخال البيانات -->
        <div class="lg:w-1/2 controls-area">
            <div id="input-form" class="bg-white p-6 rounded-xl shadow-2xl border border-gray-200 space-y-8">
                
                <!-- 1. معلومات الاتصال (تم إضافة حقل الصورة) -->
                <section class="border-b pb-6 border-blue-100">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center space-x-2 space-x-reverse"><i class="fas fa-id-badge text-blue-500"></i> 1. معلومات الاتصال</h2>
                    
                    <!-- Image Upload Area -->
                    <div class="flex flex-col items-center mb-4 p-4 border border-gray-100 rounded-xl bg-gray-50">
                        <label class="text-lg font-bold text-gray-700 mb-2">الصورة الشخصية (اختياري)</label>
                        <!-- Placeholder Image with clickable functionality -->
                        <img id="profile-pic-preview" 
                             src="https://placehold.co/100x100/eeeeee/888888?text=صورة" 
                             class="w-24 h-24 rounded-full object-cover mb-3 border-4 border-white shadow-lg cursor-pointer transition duration-300 hover:ring-2 hover:ring-blue-400" 
                             alt="معاينة الصورة" 
                             onclick="document.getElementById('profile-pic-input').click()">
                        
                        <input type="file" id="profile-pic-input" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
                        <input type="hidden" id="profile-pic-base64">
                        <p class="text-sm text-gray-500 mt-1">اضغط على الدائرة لاختيار صورة.</p>
                    </div>

                    <input type="text" id="name" placeholder="الاسم الكامل (مثال: أحمد محمد السيد)" class="input-field mb-3">
                    <input type="text" id="title" placeholder="المسمى الوظيفي (مثال: مهندس برمجيات أول)" class="input-field mb-3">
                    <input type="email" id="email" placeholder="البريد الإلكتروني (مثال: ahmad.sayed@example.com)" class="input-field mb-3">
                    <input type="text" id="phone" placeholder="رقم الهاتف (مثال: +966 50 123 4567)" class="input-field mb-3">
                    <input type="url" id="linkedin" placeholder="رابط LinkedIn (اختياري، مثال: linkedin.com/in/ahmad-sayed)" class="input-field">
                </section>

                <!-- 2. الملخص الاحترافي -->
                <section class="border-b pb-6 border-blue-100">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center space-x-2 space-x-reverse"><i class="fas fa-user-tie text-blue-500"></i> 2. الملخص الاحترافي</h2>
                    <textarea id="summary" placeholder="ملخص موجز وقوي يبرز أهم إنجازاتك وخبراتك. (مثال: مهندس برمجيات بخبرة 5 سنوات في تطوير تطبيقات الويب باستخدام React، متخصص في بناء واجهات مستخدم سريعة وموثوقة.)" class="textarea-field"></textarea>
                </section>

                <!-- 3. الخبرة العملية -->
                <section class="border-b pb-6 border-blue-100">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex justify-between items-center">
                        <span class="flex items-center space-x-2 space-x-reverse"><i class="fas fa-briefcase text-blue-500"></i> 3. الخبرة العملية</span>
                        <button onclick="showModal('experience')" class="text-sm bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-4 rounded-full transition duration-300 shadow-md transform hover:scale-105">
                            + إضافة خبرة
                        </button>
                    </h2>
                    <div id="experience-container" class="space-y-4">
                        <!-- تُضاف عناصر الخبرة هنا -->
                    </div>
                </section>

                <!-- 4. التعليم والمؤهلات -->
                <section class="border-b pb-6 border-blue-100">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex justify-between items-center">
                        <span class="flex items-center space-x-2 space-x-reverse"><i class="fas fa-graduation-cap text-blue-500"></i> 4. التعليم والمؤهلات</span>
                        <button onclick="showModal('education')" class="text-sm bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-4 rounded-full transition duration-300 shadow-md transform hover:scale-105">
                            + إضافة مؤهل
                        </button>
                    </h2>
                    <div id="education-container" class="space-y-4">
                        <!-- تُضاف عناصر التعليم هنا -->
                    </div>
                </section>
                
                <!-- 5. المشاريع -->
                <section class="border-b pb-6 border-blue-100">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex justify-between items-center">
                        <span class="flex items-center space-x-2 space-x-reverse"><i class="fas fa-code-branch text-blue-500"></i> 5. المشاريع</span>
                        <button onclick="showModal('project')" class="text-sm bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-4 rounded-full transition duration-300 shadow-md transform hover:scale-105">
                            + إضافة مشروع
                        </button>
                    </h2>
                    <div id="projects-container" class="space-y-4">
                        <!-- تُضاف عناصر المشاريع هنا -->
                    </div>
                </section>


                <!-- 6. المهارات التقنية والشخصية -->
                <section class="border-b pb-6 border-blue-100">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center space-x-2 space-x-reverse"><i class="fas fa-cogs text-blue-500"></i> 6. المهارات</h2>
                    <textarea id="skills" placeholder="المهارات التقنية (أدخلها مفصولة بفواصل، مثل: React, JavaScript, AWS, SQL) والمهارات الشخصية (مثل: حل المشكلات, العمل الجماعي)" class="textarea-field"></textarea>
                </section>

                <!-- 7. المراجع -->
                <section>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex justify-between items-center">
                        <span class="flex items-center space-x-2 space-x-reverse"><i class="fas fa-address-card text-blue-500"></i> 7. المراجع</span>
                        <button onclick="showModal('reference')" class="text-sm bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-4 rounded-full transition duration-300 shadow-md transform hover:scale-105">
                            + إضافة مرجع
                        </button>
                    </h2>
                    <div id="references-container" class="space-y-4">
                        <!-- تُضاف عناصر المراجع هنا -->
                    </div>
                </section>

                <div class="mt-6 p-4 bg-yellow-100 border border-yellow-300 rounded-lg text-sm text-right shadow-inner">
                    <p class="font-bold text-yellow-800 flex items-center space-x-2 space-x-reverse mb-2"><i class="fas fa-lightbulb text-yellow-600"></i> تذكير ATS:</p>
                    <ul class="list-disc list-inside mt-2 text-yellow-700 mr-4 space-y-1">
                        <li>استخدم الأقسام القياسية والخطوط الواضحة.</li>
                        <li>استخدم النقاط في وصف الخبرات (مثلاً: ابدأ كل سطر بـ '-').</li>
                        <li>تجنب الرسوم البيانية أو الأعمدة المعقدة لضمان سهولة الفرز.</li>
                    </ul>
                </div>
            </div>
            
            <!-- حقوق النشر في منطقة الإدخال (لا تظهر عند الطباعة) -->
            <footer class="mt-4 text-center text-sm text-gray-500 controls-area">
                جميع الحقوق محفوظة &copy; 2024.
            </footer>
        </div>

        <!-- منطقة عرض السيرة الذاتية (المعاينة والطباعة) -->
        <div class="lg:w-1/2 mt-8 lg:mt-0">
            <div id="cv-preview" class="cv-container bg-white p-6 sm:p-8 rounded-xl shadow-2xl min-h-[500px] border border-gray-200 sticky lg:top-4">
                <!-- سيتم عرض السيرة الذاتية هنا -->
                <p class="text-center text-gray-500 p-8">ابدأ بإدخال بياناتك في النموذج لعرض معاينة السيرة الذاتية.</p>
            </div>
        </div>

    </div>

    <script>
        // المتغيرات العامة
        const inputForm = document.getElementById('input-form');
        const cvPreview = document.getElementById('cv-preview');
        const templateSelector = document.getElementById('template-selector');
        const languageSelector = document.getElementById('language-selector');
        const experienceContainer = document.getElementById('experience-container');
        const educationContainer = document.getElementById('education-container');
        const projectsContainer = document.getElementById('projects-container');
        const referencesContainer = document.getElementById('references-container');
        const modal = document.getElementById('entry-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const modalSaveButton = document.getElementById('modal-save-button');
        const modalContentWrapper = document.getElementById('modal-content-wrapper');

        // Placeholder for the initial image source
        const DEFAULT_IMAGE_SRC = "https://placehold.co/100x100/eeeeee/888888?text=صورة";

        // الأنماط التلقائية للحقول
        const INPUT_CLASSES = "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-700 placeholder-gray-400 transition duration-200 shadow-inner";
        const TEXTAREA_CLASSES = "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-700 h-24 resize-y text-right placeholder-gray-400 transition duration-200 shadow-inner";

        // تعيين الأنماط على العناصر الموجودة في HTML
        document.querySelectorAll('.input-field').forEach(el => el.className = INPUT_CLASSES + " " + el.className);
        document.querySelectorAll('.textarea-field').forEach(el => el.className = TEXTAREA_CLASSES + " " + el.className);
        
        // ------------------------------------
        // 1. وظائف اللغة والترجمة
        // ------------------------------------
        const Translations = {
            ar: {
                dir: "rtl",
                // Contact Info
                name: "الاسم",
                title: "المسمى الوظيفي",
                email: "البريد الإلكتروني",
                phone: "رقم الهاتف",
                linkedin: "LinkedIn",
                // Section Titles
                h_summary: "الملخص الاحترافي",
                h_experience: "الخبرة العملية",
                h_education: "التعليم والمؤهلات",
                h_projects: "المشاريع",
                h_skills: "المهارات",
                h_references: "المراجع",
                // References Text
                reference_title: "المرجع",
                reference_available: "المراجع متاحة عند الطلب.",
            },
            en: {
                dir: "ltr",
                // Contact Info
                name: "Name",
                title: "Title",
                email: "Email",
                phone: "Phone",
                linkedin: "LinkedIn",
                // Section Titles
                h_summary: "Professional Summary",
                h_experience: "Work Experience",
                h_education: "Education & Qualifications",
                h_projects: "Projects",
                h_skills: "Skills",
                h_references: "References",
                // References Text
                reference_title: "Reference",
                reference_available: "References available upon request.",
            }
        };

        // ------------------------------------
        // 2. وظائف الصورة
        // ------------------------------------

        /**
         * Handles file selection and converts it to a Base64 string for storage and preview.
         */
        function handleImageUpload(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('profile-pic-preview');
            const hiddenInput = document.getElementById('profile-pic-base64');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const base64String = e.target.result;
                    preview.src = base64String;
                    hiddenInput.value = base64String;
                    updateCV();
                };
                reader.readAsDataURL(file);
            } else {
                preview.src = DEFAULT_IMAGE_SRC; 
                hiddenInput.value = '';
                updateCV();
            }
        }


        // ------------------------------------
        // 3. وظائف إضافة/حذف المدخلات المُضمنة
        // ------------------------------------

        /**
         * إنشاء نموذج إدخال مُضمن (Inline) للخبرة العملية
         */
        function createExperienceEntry(data = {}) {
            const entry = document.createElement('div');
            entry.className = "experience-entry p-4 border border-gray-200 rounded-xl bg-gray-50 relative shadow-sm";
            entry.innerHTML = `
                <button onclick="removeEntry(this)" class="absolute top-2 left-2 text-red-500 hover:text-red-700 text-xl font-bold transition duration-150" title="حذف">&times;</button>
                <input type="text" data-field="title" placeholder="المسمى الوظيفي" class="input-field mb-2" value="${data.title || ''}">
                <input type="text" data-field="company" placeholder="اسم الشركة" class="input-field mb-2" value="${data.company || ''}">
                <input type="text" data-field="dates" placeholder="تاريخ البدء - تاريخ الانتهاء" class="input-field mb-2" value="${data.dates || ''}">
                <tex
